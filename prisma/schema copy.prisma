generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [uuid_ossp(map: "uuid-ossp", schema: "extensions")]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model inbounds {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  lead_id      String?  @db.Uuid
  gclid        String?
  fbclid       String?
  ctwaclid     String?
  utm_source   String?
  utm_campaign String?
  utm_term     String?
  utm_content  String?
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  pipefy_id    String?  @unique(map: "inbounds_card_id_key")
  utm_medium   String?
  status       String?
  leads        leads?   @relation(fields: [lead_id], references: [id], onUpdate: NoAction)
  sales        sales[]

  @@index([created_at], map: "idx_inbounds_created_at")
  @@index([lead_id, created_at], map: "idx_inbounds_lead_created")
  @@index([lead_id], map: "idx_inbounds_lead_id")
  @@index([utm_source, utm_term, utm_campaign, utm_content], map: "idx_inbounds_utm")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model leads {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String?
  phone           String?           @unique
  remote_jid      String?           @unique
  created_at      DateTime          @default(now()) @db.Timestamptz(6)
  instagram       String?           @unique
  mail            String?
  inbounds        inbounds[]
  sales_analytics sales_analytics[]

  @@index([created_at], map: "idx_leads_created_at")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model sales {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  inbound_id    String?   @db.Uuid
  fbtrace_id    String?
  description   Json?
  service_count Int?
  amount        Decimal?  @db.Decimal(12, 2)
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  inbounds      inbounds? @relation(fields: [inbound_id], references: [id], onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model sales_analytics {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  lead_id     String?  @db.Uuid
  conversion  Json?
  qualy_audit String?
  time_audit  String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  leads       leads?   @relation(fields: [lead_id], references: [id], onUpdate: NoAction)
}
